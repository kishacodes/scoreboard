import"./hoisted.ClJjUxv0.js";function x(a,e){if(!a.dataset.gameId)return;const n=a.querySelector(".update-history");if(n){if(!e||e.length===0){n.style.display="none";return}n.style.display="block",n.innerHTML=e.map(l=>`
      <div class="update-item">
        <div class="update-meta">
          <span class="update-user">${(l.user_email||"").split("@")[0]}</span>
          <span class="update-time">${new Date(l.created_at).toLocaleString()}</span>
        </div>
        <div class="update-text">${l.update_text}</div>
      </div>
    `).join("")}}async function A(a){try{const e=await fetch(`/api/games/${a}/updates`);if(!e.ok)throw new Error("Failed to load updates");const n=(await e.json()).results||[],l=document.querySelector(`.game-card[data-game-id="${a}"]`);l&&x(l,n)}catch(e){console.error("Error loading update history:",e)}}document.addEventListener("click",async a=>{console.log("🖱️ Click event detected on:",a.target);const e=a.target;if(!e.classList.contains("update-button")){console.log("❌ Not an update button, ignoring click");return}console.log("✅ Update button click confirmed");const t=e.closest(".game-card"),n=t.dataset.gameId,l=t.querySelectorAll(".team-score-input"),m=t.querySelector(".update-text-input"),S=t.querySelector(".quarter-select"),I=S instanceof HTMLSelectElement?S:null,k=t.querySelector(".time-input"),T=k instanceof HTMLInputElement?k:null,E=t.querySelector(".game-over-checkbox"),h=m?.value.trim()||"",C=I?.value||"",b=T?.value.trim()||"",f=E?.checked||!1,d=l[0].value,u=l[1].value,v=e.textContent;e.textContent="Updating...",e.setAttribute("disabled","true");const y=o=>{console.error("Authentication error:",o),document.cookie="auth=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;",localStorage.removeItem("authToken"),window.location.href=`/login?returnTo=${encodeURIComponent(window.location.pathname)}`},q=()=>{const o=document.cookie.split("; ");console.log("🍪 All cookies:",o);const s=o.find(c=>c.startsWith("auth="));if(console.log("🔍 Auth cookie found:",s?"Yes":"No"),s){const c=s.split("=")[1];return console.log("🔑 Token from cookies (first 20 chars):",c.substring(0,20)+"..."),decodeURIComponent(c)}const r=localStorage.getItem("authToken");return console.log("🔍 localStorage token found:",r?"Yes":"No"),r?(console.log("🔑 Token from localStorage (first 20 chars):",r.substring(0,20)+"..."),r):null};console.log("🚀 Step 1 - Update Score button clicked for game:",n),console.log("📊 Step 3 - Score values extracted - EHS:",d,"OPP:",u),console.log("📝 Step 3 - Update text:",h||"(none)"),console.log("🏁 Step 3 - Game over status:",f?"Final":"In progress");const g=q();if(!g){console.error("❌ Step 3 - Authentication failed: No token found"),y("No authentication token found");return}console.log("✅ Step 3 - Authentication token validated successfully");try{console.log("🔍 PATCH Request details:",{url:`/api/games/${n}`,token:g?`${g.substring(0,10)}...`:"none",ehsScore:parseInt(d,10),oppScore:parseInt(u,10),updateText:h,isFinal:f,qtr:C,timeInqtr:b});const o={ehsScore:parseInt(d,10),oppScore:parseInt(u,10),updateText:h,qtr:C,timeInqtr:b};f&&(o.final=1,o.ehsFinal=parseInt(d,10),o.oppFinal=parseInt(u,10));const s=await fetch(`/api/games/${n}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g.trim()}`},body:JSON.stringify(o)});console.log("🔄 PATCH Response status:",s.status);let r;try{r=await s.json()}catch(w){console.error("❌ JSON Parse Error:",w);const P=s.clone();try{const p=await P.text();console.error("❌ Raw response:",p),e.textContent="JSON Parse Error",e.style.backgroundColor="#d9534f";const i=document.createElement("div");i.style.color="red",i.style.fontFamily="monospace",i.style.whiteSpace="pre-wrap",i.style.padding="10px",i.style.margin="10px 0",i.style.border="1px solid red",i.textContent=`Error parsing JSON: ${p.substring(0,500)}${p.length>500?"...":""}`,t.appendChild(i)}catch(p){console.error("❌ Could not read response text:",p)}throw new Error("Invalid JSON response from server")}if(!s.ok){if(console.error("❌ PATCH Request Failed - Status:",s.status),console.error("❌ PATCH Response:",r),s.status===401){console.error("❌ 401 Unauthorized - Token may be invalid or expired"),e.textContent="Auth Error - Check Console",e.style.backgroundColor="#d9534f",setTimeout(()=>{y("Session expired")},5e3);return}throw new Error(r.error||"Failed to update score")}m&&(m.value="");const c=t.querySelectorAll(".team-score-input");c[0]&&c[1]&&(c[0].value=String(d),c[1].value=String(u)),r.updates&&r.updates.length>0?x(t,r.updates):await A(n),e.textContent="Updated!",setTimeout(()=>{e.textContent=v,e.removeAttribute("disabled")},2e3)}catch(o){if(console.error("Update Error:",o),o instanceof Error&&o.message.includes("token")){y("Invalid session");return}e.textContent="Error!",e.style.backgroundColor="#d9534f",setTimeout(()=>{e.textContent=v,e.removeAttribute("disabled"),e.style.backgroundColor=""},3e3)}});document.addEventListener("DOMContentLoaded",()=>{if(console.log("🚀 AdminScoreboardDisplay script loaded"),console.log("📄 Current page body dataset:",document.body.dataset),console.log("🎯 Game cards found:",document.querySelectorAll(".game-card").length),console.log("🔘 Update buttons found:",document.querySelectorAll(".update-button").length),!(document.querySelector('[data-page="admin"]')!==null)){console.log("❌ Not on admin page, skipping initialization");return}console.log("✅ Admin page confirmed"),document.querySelectorAll(".game-card").forEach(e=>{const t=e.dataset.gameId;t&&A(t)})});
