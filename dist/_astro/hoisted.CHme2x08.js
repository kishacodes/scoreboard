import"./hoisted.DxfSxqbr.js";async function l(o){try{const t=await fetch(`/api/games/${o}/updates`);if(!t.ok)throw new Error("Failed to load updates");const n=await t.json(),e=document.getElementById(`update-history-${o}`);if(!e)return;if(n.length===0){e.style.display="none";return}e.style.display="block",e.innerHTML=n.map(a=>`
        <div class="update-item">
          <div class="update-meta">
            <span class="update-user">${a.user_email.split("@")[0]}</span>
            <span class="update-time">${new Date(a.created_at).toLocaleString()}</span>
          </div>
          <div class="update-text">${a.update_text}</div>
        </div>
      `).join("")}catch(t){console.error("Error loading update history:",t)}}document.addEventListener("click",async o=>{const t=o.target;if(!t.classList.contains("update-button"))return;const n=t.closest(".game-card"),e=n.dataset.gameId,a=n.querySelectorAll(".team-score-input"),i=n.querySelector(".update-text-input"),u=i?.value.trim()||"",p=a[0].value,m=a[1].value,d=t.textContent;t.textContent="Updating...",t.setAttribute("disabled","true");try{if(!(await fetch(`/api/games/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({ehsFinal:parseInt(p,10),oppFinal:parseInt(m,10),updateText:u})})).ok)throw new Error("Failed to update score");i&&(i.value=""),await Promise.all([l(e),fetch(`/api/games/${e}`).then(s=>s.ok?s.json():null).then(s=>{if(s){const r=n.querySelectorAll(".team-score-input");r[0]&&r[1]&&(r[0].value=String(s.ehsFinal),r[1].value=String(s.oppFinal))}})]),t.textContent="Updated!",setTimeout(()=>{t.textContent=d,t.removeAttribute("disabled")},2e3)}catch(c){console.error("Update Error:",c),t.textContent="Error!",t.style.backgroundColor="#d9534f",setTimeout(()=>{t.textContent=d,t.removeAttribute("disabled"),t.style.backgroundColor=""},3e3)}});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".game-card").forEach(o=>{const t=o.dataset.gameId;t&&l(t)})});
