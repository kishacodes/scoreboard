function r(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")}function h(t){if(!t)return new Date(NaN);if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(?::\d{2})?$/.test(t)){const o=t.replace(" ","T"),s=t.length===16?`${o}:00Z`:`${o}Z`;return new Date(s)}return new Date(t)}function v(t){const n=h(t);return isNaN(n.getTime())?String(t||""):n.toLocaleTimeString("en-US",{timeZone:"America/Chicago",hour:"numeric",minute:"2-digit"})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".game-card[data-game-id]").forEach(t=>{const n=t,o=n.getAttribute("data-game-id"),s=n.querySelector(".updates-details");if(!s||!o)return;const i=n.querySelector(".updates-list"),l=n.querySelector(".updates-heading");s.addEventListener("toggle",async()=>{if(s.open&&s.getAttribute("data-loaded")!=="true")try{const p=await fetch(`/api/games/${o}/updates`),c=p.ok?await p.json():[];if(l&&(l.textContent=c.length>0?`Recent Updates (${c.length})`:"Recent Updates (0)"),!i)return;const m=n.querySelectorAll(".team .team-name"),f=m[0]?.textContent?.trim()||"EHS",x=m[1]?.textContent?.trim()||"Opponent";!c||c.length===0?i.innerHTML='<li class="update-item"><div class="update-row"><span class="update-text">No updates yet</span><span class="update-timestamp"></span></div></li>':i.innerHTML=c.map(a=>{const u=a.qtr||a.ehs_score!=null||a.opp_score!=null?`<div class="update-meta">${r(a.qtr||"")}${a.qtr?": ":""}${r(f)} ${r(String(a.ehs_score??""))}, ${r(x)} ${r(String(a.opp_score??""))}</div>`:"";return`<li class="update-item">
                <div class="update-row">
                  <span class="update-text" title="${r(a.update_text)}">${r(a.update_text)}</span>
                  <span class="update-timestamp">${r(v(a.created_at))}</span>
                </div>
                ${u}
              </li>`}).join(""),i&&i.querySelectorAll(".update-text").forEach(u=>{const e=u;e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-expanded","false"),e.style.cursor="pointer";const g=()=>{const d=e.classList.toggle("expanded");e.setAttribute("aria-expanded",d?"true":"false")};e.addEventListener("click",g),e.addEventListener("keydown",d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),g())}),requestAnimationFrame(()=>{e.scrollHeight>e.clientHeight||(e.removeAttribute("role"),e.removeAttribute("tabindex"),e.removeAttribute("aria-expanded"),e.style.cursor="")})}),s.setAttribute("data-loaded","true")}catch{l&&(l.textContent="Recent Updates (0)"),i&&(i.innerHTML='<li class="update-item"><div class="update-row"><span class="update-text">No updates yet</span><span class="update-timestamp"></span></div></li>'),s.setAttribute("data-loaded","true")}})})});
