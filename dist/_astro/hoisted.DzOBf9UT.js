function s(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")}function g(e){if(!e)return new Date(NaN);if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(?::\d{2})?$/.test(e)){const i=e.replace(" ","T"),n=e.length===16?`${i}:00Z`:`${i}Z`;return new Date(n)}return new Date(e)}function f(e){const a=g(e);return isNaN(a.getTime())?String(e||""):a.toLocaleTimeString("en-US",{timeZone:"America/Chicago",hour:"numeric",minute:"2-digit"})}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".game-card[data-game-id]").forEach(e=>{const a=e,i=a.getAttribute("data-game-id"),n=a.querySelector(".updates-details");if(!n||!i)return;const r=a.querySelector(".updates-list"),c=a.querySelector(".updates-heading");n.addEventListener("toggle",async()=>{if(n.open&&n.getAttribute("data-loaded")!=="true")try{const o=await fetch(`/api/games/${i}/updates`),d=o.ok?await o.json():[];if(c&&(c.textContent=d.length>0?`Recent Updates (${d.length})`:"Recent Updates (0)"),!r)return;const p=a.querySelectorAll(".team .team-name"),l=p[0]?.textContent?.trim()||"EHS",u=p[1]?.textContent?.trim()||"Opponent";!d||d.length===0?r.innerHTML='<li class="update-item"><div class="update-row"><span class="update-text">No updates yet</span><span class="update-timestamp"></span></div></li>':r.innerHTML=d.map(t=>{const m=t.qtr||t.ehs_score!=null||t.opp_score!=null?`<div class="update-meta">${s(t.qtr||"")}${t.qtr?": ":""}${s(l)} ${s(String(t.ehs_score??""))}, ${s(u)} ${s(String(t.opp_score??""))}</div>`:"";return`<li class="update-item">
                <div class="update-row">
                  <span class="update-text" title="${s(t.update_text)}">${s(t.update_text)}</span>
                  <span class="update-timestamp">${s(f(t.created_at))}</span>
                </div>
                ${m}
              </li>`}).join(""),n.setAttribute("data-loaded","true")}catch{c&&(c.textContent="Recent Updates (0)"),r&&(r.innerHTML='<li class="update-item"><div class="update-row"><span class="update-text">No updates yet</span><span class="update-timestamp"></span></div></li>'),n.setAttribute("data-loaded","true")}})})});
