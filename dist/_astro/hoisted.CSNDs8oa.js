import"./hoisted.DxfSxqbr.js";function y(e,t){if(!e.dataset.gameId)return;const a=e.querySelector(".update-history");if(a){if(!t||t.length===0){a.style.display="none";return}a.style.display="block",a.innerHTML=t.map(o=>`
      <div class="update-item">
        <div class="update-meta">
          <span class="update-user">${(o.user_email||"").split("@")[0]}</span>
          <span class="update-time">${new Date(o.created_at).toLocaleString()}</span>
        </div>
        <div class="update-text">${o.update_text}</div>
      </div>
    `).join("")}}async function f(e){try{const t=await fetch(`/api/games/${e}/updates`);if(!t.ok)throw new Error("Failed to load updates");const a=(await t.json()).results||[],o=document.querySelector(`.game-card[data-game-id="${e}"]`);o&&y(o,a)}catch(t){console.error("Error loading update history:",t)}}document.addEventListener("click",async e=>{const t=e.target;if(!t.classList.contains("update-button"))return;const n=t.closest(".game-card"),a=n.dataset.gameId,o=n.querySelectorAll(".team-score-input"),i=n.querySelector(".update-text-input"),h=i?.value.trim()||"",d=o[0].value,c=o[1].value,u=t.textContent;t.textContent="Updating...",t.setAttribute("disabled","true");try{const p=(v=>{const g=`; ${document.cookie}`.split(`; ${v}=`);if(g.length===2)return g.pop()?.split(";").shift()})("auth");if(!p)throw new Error("Not authenticated");const m=await fetch(`/api/games/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({ehsFinal:parseInt(d,10),oppFinal:parseInt(c,10),updateText:h})}),r=await m.json();if(!m.ok)throw new Error(r.error||"Failed to update score");i&&(i.value="");const s=n.querySelectorAll(".team-score-input");s[0]&&s[1]&&(s[0].value=String(d),s[1].value=String(c)),r.updates&&r.updates.length>0?y(n,r.updates):await f(a),t.textContent="Updated!",setTimeout(()=>{t.textContent=u,t.removeAttribute("disabled")},2e3)}catch(l){console.error("Update Error:",l),t.textContent="Error!",t.style.backgroundColor="#d9534f",setTimeout(()=>{t.textContent=u,t.removeAttribute("disabled"),t.style.backgroundColor=""},3e3)}});document.addEventListener("DOMContentLoaded",()=>{document.body.dataset.page==="admin"&&document.querySelectorAll(".game-card").forEach(e=>{const t=e.dataset.gameId;t&&f(t)})});
