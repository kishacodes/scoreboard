---
// src/components/ScoreboardDisplay.astro
const { games } = Astro.props;

const formatDate = (dateString: string) => {
  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' };
  return new Date(dateString).toLocaleDateString('en-US', options);
}

const toTitleCase = (str: string) => {
  if (!str) return '';
  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
}
---

<div class="scoreboard-grid">
  {games.map(game => (
    <div class="game-card">
      <div class="game-header">
        <span class="game-date">{formatDate(game.gameDate)}</span>
        <span class="game-level">{toTitleCase(game.teams)}</span>
      </div>
      <div class="game-body">
        <div class="team">
          <span class="team-name">{game.ehs}</span>
          <span class="team-score">{game.ehsScore}</span>
        </div>
        <div class="team">
          <span class="team-name">{game.opp}</span>
          <span class="team-score">{game.oppScore}</span>
        </div>
        {game.final === 1 ? (
          <div class="game-status">
            <span class="game-final">FINAL</span>
          </div>
        ) : (
          (game.qtr || game.timeInqtr) && (
            <div class="game-status">
              {game.qtr && <span class="game-quarter">{game.qtr}</span>}
              {game.timeInqtr && <span class="game-time">{game.timeInqtr}</span>}
            </div>
          )
        )}
      </div>
      <div class="game-footer">
        {game.comments && (
          <p class="game-comment">{game.comments}</p>
        )}
        
        {game.updates && game.updates.length > 0 && (
          <div class="game-updates">
            <details class="updates-details">
              <summary class="updates-heading">Recent Updates ({game.updates.length})</summary>
              <ul class="updates-list">
                {game.updates.map((update: any) => (
                  <li class="update-item">
                    <div class="update-row">
                      <span class="update-text" title={update.update_text}>{update.update_text}</span>
                      <span class="update-timestamp">{update.created_at}</span>
                    </div>
                  </li>
                ))}
              </ul>
            </details>
          </div>
        )}
      </div>
    </div>
  ))}
</div>

<style>
  .game-status {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #555;
  }
  
  .game-quarter {
    font-weight: bold;
    background-color: #f0f0f0;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    border: 1px solid #ddd;
  }
  
  .game-time {
    font-family: monospace;
  }
  
  .game-final {
    font-weight: bold;
    color: #d9534f;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0.25rem 0.5rem;
    border: 1px solid #d9534f;
    border-radius: 3px;
  }
  
  .game-updates {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #eee;
  }
  
  .updates-heading {
    font-size: 0.9rem;
    font-weight: 600;
    color: #555;
    cursor: pointer;
  }
  
  .updates-details {
    width: 100%;
  }
  
  .updates-details summary {
    padding: 0.2rem 0;
    list-style: none;
    display: flex;
    align-items: center;
  }
  
  .updates-details summary::before {
    content: '▶';
    display: inline-block;
    margin-right: 0.5rem;
    font-size: 0.7rem;
    color: #777;
  }
  
  .updates-details[open] summary::before {
    content: '▼';
  }
  
  .updates-list {
    list-style: none;
    padding: 0;
    margin: 0.5rem 0 0 0;
    font-size: 0.85rem;
  }
  
  .update-item {
    padding: 0.5rem;
    margin-bottom: 0.5rem;
    background-color: #f9f9f9;
    border-left: 3px solid #ddd;
  }
  
  .update-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
  }
  
  .update-text {
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
  }
  
  .update-timestamp {
    font-size: 0.75rem;
    color: #888;
    white-space: nowrap;
  }
</style>
